# ëª©ì°¨

# JPAë¥¼ ê³µë¶€í•˜ëŠ”ë° ê°€ì¥ ì¤‘ìš”í•œ 2ê°€ì§€

## 1. ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ë§¤í•‘ ê·¸ìì²´

## 2. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸

# ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸

> ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” í™˜ê²½(ë…¼ë¦¬ì ì¸ ê³µê°„). EntityManger.persist(entity)
> 

<aside>
ğŸ’¡ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ = EntityManagerê°€ ë§Œë“œëŠ” Javaì™€ DB ì‚¬ì´ì˜ ë²„í¼ ì˜ì—­

</aside>

## ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬ì™€ ì—”í‹°í‹° ë§¤ë‹ˆì €

- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­ì´ ì™”ì„ë•Œ ì—”í‹°í‹° íŒ©í† ë¦¬ì—ì„œ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ìƒì„±í•˜ê³  ì—”í‹°í‹° ë§¤ë‹ˆì €ê°€ DBì™€ ì»¤ë„¥ì…˜ í’€ì„ ì´ìš©í•´ DB ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. ì—”í‹°í‹°ëŠ” ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ í†µí•´ì„œë§Œ ì˜ì†ì† ì»¨íƒìŠ¤íŠ¸ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤.
    - 
        
        ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/e8dc9b1a-ebd7-4746-8b87-278cc7cc5d56/448dc875-b750-46e6-aa0f-88f8ffe4209a/Untitled.png)
        

## ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸°

- new/transient(ë¹„ì˜ì†)
- manage(ì˜ì†) : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì˜ì˜ìœ¼ë¡œ ì…ê°¤ â€”> Transactionì´ ëë‚˜ë©´ ì¿¼ë¦¬ ë‚ ë¼ê°€ì„œ DBì— ë°˜ì˜
- detach(ì¤€ì˜ì†) : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì˜ì—­ ë°–ìœ¼ë¡œ ì œì™¸ â€”> Transactionì´ ëë‚˜ëŠ” ì‹œì ì— ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì˜ì—­ ë°–ì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì—”í‹°í‹°ì—ëŒ€í•œ ì¿¼ë¦¬ë¬¸ìì²´ê°€ ìƒì„±ë˜ì§€ ì•Šê³  ë”í‹°ì²´í‚¹ë„ ë˜ì§€ ì•ŠìŒ
    
    ```java
    tx.begin()
    
    Member member = em.find(Member.class, "memberA");  // ì˜ì†ìƒíƒœ
    member.SetName("tkdtn");
    em.detach(member);
    
    tx.commit();
    ```
    
- removed(ì‚­ì œëœ ìƒíƒœ) : DBì—ì„œë„ ì‚­ì œí•œë‹¤ëŠ” ëœ»

![ìƒëª… ì£¼ê¸°ë³„ EntityManger method](https://prod-files-secure.s3.us-west-2.amazonaws.com/e8dc9b1a-ebd7-4746-8b87-278cc7cc5d56/e8ea6b13-46c5-41dd-b573-970dc1ca6ccd/Untitled.png)

ìƒëª… ì£¼ê¸°ë³„ EntityManger method

- ìƒëª… ì£¼ê¸° í•œ ë£¨í‹´
    
    ```java
    EntityManagerFactory emf = Persistence.createEntityManagerFactory(??)
    EntityManger em = emf.createEntityManger();
    EntityTransaction tx = em.getTransaction();
    
    tx.begin(); // Transaction ì‹œì‘ êµ¬ê°„
    
    Member member = new Member();
    member.SetId(100L);
    member.SetName("ìƒìˆ˜");
    ---------------------------------------------JPAì™€ ì•„ë¬´ ê´€ë ¨ ì—†ëŠ” ë¹„ì˜ì† ìƒíƒœ
    em.persist(member);
    ---------------------------------------------ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ì…ê°¤(DBì— ì €ì¥ëœ ìƒíƒœ ì•„ë‹˜)
    em.detach(member);
    ---------------------------------------------ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ì—ì„œ ì•„ì›ƒ
    em.persist(member);
    ---------------------------------------------ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ì…ê°¤(DBì— ì €ì¥ëœ ìƒíƒœ ì•„ë‹˜)
    tx.commit();
    ---------------------------------------------Transaction ì¢…ë£Œ, ì¿¼ë¦¬ì³ì„œ DBì— ë°˜ì˜
    em.close();
    ---------------------------------------------ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ì˜ì—… ì¢…ë£Œ(ëª¨ë“  ì—”í‹°í‹°ê°€ ì¤€ì˜ì†ìƒíƒœë¡œ ë³€ê²½)
    
    ```
    

### ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì´ì 

<aside>
ğŸ’¡ ë²„í¼ë§ê³¼ ìºì‹±ì´ í•µì‹¬

</aside>

- 1ì°¨ ìºì‹œ : ê°™ì€ Transaction ë‚´ì—ì„œ í•„ìš”í•œ ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ì˜ì—­ì— ìˆë‹¤ë©´ DB ì¡°íšŒê¹Œì§€ í•  í•„ìš”ë„ ì—†ì´ ê·¸ë†ˆ êº¼ë‚´ì„œ ë°˜í™˜í•´ì¤Œâ€”> DB ì¡°íšŒë¥¼ ì•ˆ í•˜ê¸° ë•Œë¬¸ì— ë¹ ë¦„
    
    ```java
    tx.begin();
    Member member = new Member();
    member.SetId(100L);
    member.SetNaem("ìƒìˆ˜");
    em.find(member);
    tx.commit();
    ```
    
- ë™ì¼ì„± ë³´ì¥ â€”> ê°™ì€ Transaction ë‚´ì—ì„œ ë™ì¼ì„ ì„ ë³´ì¥í•¨ == ìœ¼ë¡œ ë¹„êµí•´ë„ ê°™ìŒ
    - Transaction ë‚´ì—ì„œ ë˜‘ê°™ì€ë†ˆ ì¡°íšŒí•´ì„œ ê°€ì ¸ì˜¨ê²Œ ê°™ë‹¤ëŠ” íŒì •ì„ í•œë‹¤ëŠ”ê±°ì„
- íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—° â€”> ì—”í‹°í‹°ì˜ ì •ë³´ê°€ ë³€ê²½ ë ë•Œë§ˆë‹¤ ì¿¼ë¦¬ë¥¼ ì³ì„œ DBì— ë°˜ì˜í•˜ëŠ”ê²Œì•„ë‹Œ ì¿¼ë¦¬ ë‚ ë¦´ê±° ì¢€ ëª¨ì•„ë†¨ë‹¤ê°€ í•œë°©ì— ì²˜ë¦¬í•¨ â€”> DB ì¡°íšŒ íšŸìˆ˜ê°€ ê°ì†Œí•˜ê¸° ë•Œë¬¸ì— ì†ë„ê°€ ë¹¨ë¼ì§
- ë³€ê²½ ê°ì§€ â€”> ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ë‚´ì—ìˆëŠ” ì—”í‹°í‹°ëŠ” ê·¸ëƒ¥ ì•Œì•„ì„œ ë³€ê²½ê°ì§€ë¥¼ í†µí•´ DBì— ë°˜ì˜ì´ë¨, ì°¸ê³ ë¡œ DBì—ì„œ êº¼ë‚´ì˜¨ ê°ì²´ëŠ” ì´ë¯¸ ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ì˜ì—­ì— í¬í•¨ì´ ë˜ì–´ìˆëŠ” ìƒíƒœì„ ê·¸ë˜ì„œ persistë”°ë¡œ í•  í•„ìš” ì—†ë‹¤.
    
    ```java
    tx.begin();
    Member memberA = em.find(Member.class, "memberA");    // memberAëŠ” ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ì— í¬í•¨
    member.SetName("tkdtn");
    tx.commit();
    ```
    
- ì§€ì—° ë¡œë”© â€”> DBì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‘ì—…ì„ ì§„ì§œ ê·¸ ë°ì´í„°ê°€ í•„ìš”í•œ ì‹œì ê¹Œì§€ ë¯¸ë£¨ëŠ” ì‘ì—…

### ìë™ìœ¼ë¡œ flush()ê°€ ë˜ëŠ” ì‹œì 

- `em.flush();` ëŠ” ì¼ë‹¨ ì¿¼ë¦¬ëŠ” ë‚˜ê°€ê³  commitì€ ì•ˆëœ ì‹œì ì´ë‹¤. í˜„ì¬ê¹Œì§€ì˜ DB ë³€ê²½ë¶„ì´ ë°˜ì˜ì€ ëì§€ë§Œ ë¡¤ë°±ì€ ê°€ëŠ¥í•œ ìƒíƒœ ê·¸ë¦¬ê³  ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ì˜ ì €ì¥ ìƒíƒœë„ ìœ ì§€ëœë‹¤.
- íŠ¸ëœì­ì…˜ ì»¤ë°‹ - í”ŒëŸ¬ì‹œ ìë™ í˜¸ì¶œ
- JPQL ì¿¼ë¦¬ ì‹¤í–‰ - í”ŒëŸ¬ì‹œ ë‚ ë¦¬ê³  JPQL ì‹¤í–‰í•¨

### ì¤€ì˜ì† ìƒíƒœë¡œ ë§Œë“œëŠ” ë°©ë²•

- `em.detach(Entity)`;
- `em.clear();` : ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ì˜ì—­ì„ ê·¸ëƒ¥ ì‹¹ ë¹„ì›€
- `em.close();` : ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸ ìì²´ê°€ ì‚¬ë¼ì§